<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Rio Genil - Ecija</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            color: white;
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 0.9em;
            letter-spacing: 1px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75em;
            margin-top: 10px;
            font-weight: bold;
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
            animation: pulse-badge 2s infinite;
        }

        @keyframes pulse-badge {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .nivel-principal {
            background: white;
            border-radius: 20px;
            padding: 45px 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            margin-bottom: 15px;
            text-align: center;
            border: 3px solid;
            position: relative;
            overflow: hidden;
        }

        .nivel-principal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
        }

        .nivel-verde {
            border-color: #22c55e;
        }
        .nivel-verde::before {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        .nivel-amarillo {
            border-color: #eab308;
            animation: glow-amarillo 2s ease-in-out infinite;
        }
        .nivel-amarillo::before {
            background: linear-gradient(90deg, #eab308, #f59e0b);
        }

        .nivel-naranja {
            border-color: #f97316;
            animation: glow-naranja 2s ease-in-out infinite;
        }
        .nivel-naranja::before {
            background: linear-gradient(90deg, #f97316, #ea580c);
        }

        .nivel-rojo {
            border-color: #ef4444;
            animation: glow-rojo 1.5s ease-in-out infinite;
        }
        .nivel-rojo::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .nivel-critico {
            border-color: #991b1b;
            animation: glow-critico 1s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(153, 27, 27, 0.5);
        }
        .nivel-critico::before {
            background: linear-gradient(90deg, #991b1b, #7f1d1d);
        }

        @keyframes glow-amarillo {
            0%, 100% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 20px rgba(234, 179, 8, 0.3); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 40px rgba(234, 179, 8, 0.6); }
        }

        @keyframes glow-naranja {
            0%, 100% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 25px rgba(249, 115, 22, 0.4); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 50px rgba(249, 115, 22, 0.7); }
        }

        @keyframes glow-rojo {
            0%, 100% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 30px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 60px rgba(239, 68, 68, 0.8); }
        }

        @keyframes glow-critico {
            0%, 100% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 40px rgba(153, 27, 27, 0.7); }
            50% { box-shadow: 0 10px 25px rgba(0,0,0,0.3), 0 0 80px rgba(153, 27, 27, 1); }
        }

        .nivel-valor {
            font-size: 7em;
            font-weight: 900;
            line-height: 1;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.15);
        }

        .color-verde { color: #22c55e; }
        .color-amarillo { color: #eab308; }
        .color-naranja { color: #f97316; }
        .color-rojo { color: #ef4444; }
        .color-critico { 
            color: #991b1b; 
            animation: pulse-text 1s infinite;
        }

        @keyframes pulse-text {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .nivel-unidad {
            font-size: 2.5em;
            color: #64748b;
            margin-left: 10px;
            font-weight: 600;
        }

        .nivel-label {
            font-size: 1.2em;
            color: #475569;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 600;
        }

        .alert-indicator {
            display: inline-block;
            padding: 14px 40px;
            border-radius: 35px;
            font-weight: bold;
            font-size: 1.3em;
            margin-top: 25px;
            text-transform: uppercase;
            letter-spacing: 3px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }

        .alert-verde {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .alert-amarillo {
            background: linear-gradient(135deg, #eab308, #f59e0b);
            color: white;
        }

        .alert-naranja {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }

        .alert-rojo {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            animation: pulse-alert 2s infinite;
        }

        .alert-critico {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            color: white;
            animation: pulse-alert 1s infinite;
            box-shadow: 0 0 30px rgba(153, 27, 27, 0.6);
        }

        @keyframes pulse-alert {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .datos-secundarios {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            margin-bottom: 15px;
        }

        .datos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .dato-item {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #cbd5e1;
            transition: transform 0.2s;
        }

        .dato-item:hover {
            transform: translateY(-3px);
        }

        .dato-label {
            color: #64748b;
            font-size: 0.85em;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dato-value {
            color: #1e293b;
            font-size: 1.8em;
            font-weight: bold;
        }

        .dato-unit {
            font-size: 0.6em;
            color: #64748b;
            margin-left: 4px;
        }

        .dato-no-disponible {
            color: #94a3b8;
            font-style: italic;
            font-size: 1.2em;
        }

        .datos-extra {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .dato-extra {
            background: #f8fafc;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .dato-extra-label {
            font-size: 0.7em;
            color: #64748b;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dato-extra-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #1e293b;
        }

        .thresholds {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #cbd5e1;
        }

        .threshold-title {
            color: #1e293b;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .threshold-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .threshold-verde {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
        }

        .threshold-amarillo {
            background: rgba(234, 179, 8, 0.1);
            border-left: 4px solid #eab308;
        }

        .threshold-naranja {
            background: rgba(249, 115, 22, 0.1);
            border-left: 4px solid #f97316;
        }

        .threshold-rojo {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
        }

        .threshold-critico {
            background: rgba(153, 27, 27, 0.1);
            border-left: 4px solid #991b1b;
        }

        .chart-container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            margin-bottom: 15px;
        }

        .chart-title {
            color: #1e293b;
            font-size: 1.2em;
            margin-bottom: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .update-info {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            text-align: center;
            color: #64748b;
            font-size: 0.9em;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 12px;
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
            font-weight: 600;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.6);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn:disabled {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            cursor: not-allowed;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: white;
            font-size: 1.6em;
        }

        .spinner {
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 25px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 16px rgba(239, 68, 68, 0.4);
        }

        .footer {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            color: #64748b;
            font-size: 0.8em;
            margin-top: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const MonitorGenil = () => {
            const [datos, setDatos] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [historico, setHistorico] = useState([]);
            const [refreshing, setRefreshing] = useState(false);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const UMBRALES = {
                amarillo: 2.7,
                naranja: 4.0,
                rojo: 5.0,
                critico: 7.0
            };

            const PROXIES = [
                'https://api.codetabs.com/v1/proxy?quest=',
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url='
            ];

            const SAIH_URL = 'https://www.chguadalquivir.es/saih/AforosTabla.aspx';

            const obtenerDatosSAIH = async () => {
                for (let i = 0; i < PROXIES.length; i++) {
                    try {
                        const url = PROXIES[i] + encodeURIComponent(SAIH_URL);
                        const response = await fetch(url);
                        
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        
                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        const tablas = doc.querySelectorAll('table');
                        
                        for (let tabla of tablas) {
                            const filas = tabla.querySelectorAll('tr');
                            
                            for (let fila of filas) {
                                const texto = fila.textContent.toUpperCase();
                                
                                if ((texto.includes('ECIJA') || texto.includes('A17')) && texto.includes('GENIL')) {
                                    const celdas = fila.querySelectorAll('td');
                                    
                                    console.log('=== FILA ECIJA ENCONTRADA ===');
                                    console.log('Numero total de celdas:', celdas.length);
                                    
                                    // Mostrar todas las celdas para debug
                                    celdas.forEach((celda, idx) => {
                                        console.log(`Celda ${idx}:`, celda.textContent.trim());
                                    });
                                    
                                    if (celdas.length >= 7) {
                                        // Columna 3: Calado (nivel) en m.l.a
                                        const valorNivel = celdas[2].textContent.trim(); // √≠ndice 2 = columna 3
                                        const nivel = parseFloat(valorNivel.replace(',', '.'));
                                        
                                        // Columna 7: Caudal en m¬≥/s
                                        const valorCaudal = celdas[6].textContent.trim(); // √≠ndice 6 = columna 7
                                        const caudalLimpio = valorCaudal.replace(/[^\d,.-]/g, '');
                                        const caudal = parseFloat(caudalLimpio.replace(',', '.'));
                                        
                                        // Columna 5: Cota (opcional, para referencia)
                                        const valorCota = celdas[4].textContent.trim(); // √≠ndice 4 = columna 5
                                        const cota = parseFloat(valorCota.replace(',', '.'));
                                        
                                        console.log('Nivel extra√≠do (columna 3):', nivel);
                                        console.log('Caudal extra√≠do (columna 7):', caudal);
                                        console.log('Cota extra√≠da (columna 5):', cota);
                                        
                                        // Validar nivel
                                        if (!isNaN(nivel) && nivel >= 0 && nivel <= 15) {
                                            return {
                                                nivel: nivel,
                                                caudal: (!isNaN(caudal) && caudal >= 0 && caudal < 5000) ? caudal : null,
                                                cota: (!isNaN(cota)) ? cota : null,
                                                timestamp: new Date().toISOString(),
                                                estacion: 'A17',
                                                fuente: 'SAIH',
                                                proxyUsado: i + 1,
                                                ultimaActualizacion: new Date().toLocaleTimeString('es-ES')
                                            };
                                        } else {
                                            console.error('Nivel invalido:', nivel);
                                        }
                                    } else {
                                        console.warn('La fila no tiene suficientes columnas:', celdas.length);
                                    }
                                }
                            }
                        }
                        
                        throw new Error('No se encontraron datos de Ecija');
                        
                    } catch (err) {
                        console.warn(`Proxy ${i + 1} fallo:`, err.message);
                        if (i === PROXIES.length - 1) throw err;
                        continue;
                    }
                }
            };

            const obtenerEstadoAlerta = (nivel) => {
                if (nivel >= UMBRALES.critico) return { 
                    clase: 'critico', 
                    texto: 'NIVEL CRITICO',
                    color: 'critico'
                };
                if (nivel >= UMBRALES.rojo) return { 
                    clase: 'rojo', 
                    texto: 'EMERGENCIA',
                    color: 'rojo'
                };
                if (nivel >= UMBRALES.naranja) return { 
                    clase: 'naranja', 
                    texto: 'ALERTA',
                    color: 'naranja'
                };
                if (nivel >= UMBRALES.amarillo) return { 
                    clase: 'amarillo', 
                    texto: 'PRECAUCION',
                    color: 'amarillo'
                };
                return { 
                    clase: 'verde', 
                    texto: 'NORMAL',
                    color: 'verde'
                };
            };

            const calcularTendencia = () => {
                if (historico.length < 3) return 'Estable';
                const ultimos3 = historico.slice(-3).map(h => h.nivel);
                const diff = ultimos3[2] - ultimos3[0];
                
                if (diff > 0.1) return 'Subiendo';
                if (diff < -0.1) return 'Bajando';
                return 'Estable';
            };

            const calcularVariacion = () => {
                if (historico.length < 2) return null;
                const anterior = historico[historico.length - 2].nivel;
                const actual = historico[historico.length - 1].nivel;
                const diff = actual - anterior;
                return diff > 0 ? `+${diff.toFixed(2)}` : diff.toFixed(2);
            };

            const cargarDatos = async () => {
                try {
                    setRefreshing(true);
                    const nuevosDatos = await obtenerDatosSAIH();
                    setDatos(nuevosDatos);
                    setError(null);

                    setHistorico(prev => {
                        const nuevo = [...prev, {
                            tiempo: new Date().toLocaleTimeString('es-ES', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            }),
                            nivel: nuevosDatos.nivel,
                            caudal: nuevosDatos.caudal
                        }];
                        return nuevo.slice(-20);
                    });
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                    setRefreshing(false);
                }
            };

            useEffect(() => {
                cargarDatos();
                const interval = setInterval(cargarDatos, 180000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                if (historico.length > 1 && chartRef.current) {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    const ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: historico.map(h => h.tiempo),
                            datasets: [{
                                label: 'Nivel (m)',
                                data: historico.map(h => h.nivel),
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                borderWidth: 3,
                                tension: 0.4,
                                fill: true,
                                pointRadius: 5,
                                pointBackgroundColor: '#3b82f6',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    padding: 12,
                                    titleFont: { size: 13 },
                                    bodyFont: { size: 12 }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    ticks: { 
                                        font: { size: 12, weight: '600' },
                                        color: '#475569'
                                    },
                                    grid: { color: '#e2e8f0' }
                                },
                                x: {
                                    ticks: { 
                                        font: { size: 11 },
                                        color: '#64748b'
                                    },
                                    grid: { color: '#f1f5f9' }
                                }
                            }
                        }
                    });
                }
            }, [historico]);

            if (loading) {
                return (
                    <div className="loading">
                        <div>Conectando con SAIH...</div>
                        <div className="spinner"></div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>Monitor Rio Genil</h1>
                            <p>Ecija - Estacion A17</p>
                        </div>
                        <div className="error">
                            <h3 style={{marginBottom: '10px', fontSize: '1.4em'}}>Error de Conexion</h3>
                            <p style={{fontSize: '1em', marginBottom: '15px'}}>{error}</p>
                            <button className="refresh-btn" onClick={cargarDatos}>
                                Reintentar Conexion
                            </button>
                        </div>
                    </div>
                );
            }

            const alerta = obtenerEstadoAlerta(datos.nivel);
            const tendencia = calcularTendencia();
            const variacion = calcularVariacion();

            return (
                <div className="container">
                    <div className="header">
                        <h1>Rio Genil - Ecija</h1>
                        <p>Estacion A17 - SAIH Guadalquivir</p>
                        <span className="status-badge">‚óè EN VIVO</span>
                    </div>

                    <div className={`nivel-principal nivel-${alerta.clase}`}>
                        <div>
                            <span className={`nivel-valor color-${alerta.color}`}>
                                {datos.nivel.toFixed(2)}
                            </span>
                            <span className="nivel-unidad">m</span>
                        </div>
                        <div className="nivel-label">Altura del Agua</div>
                        <div className={`alert-indicator alert-${alerta.clase}`}>
                            {alerta.texto}
                        </div>
                    </div>

                    <div className="datos-secundarios">
                        <div className="datos-grid">
                            <div className="dato-item">
                                <div className="dato-label">Caudal</div>
                                <div className="dato-value">
                                    {datos.caudal !== null ? (
                                        <>{datos.caudal.toFixed(1)}<span className="dato-unit">m¬≥/s</span></>
                                    ) : (
                                        <span className="dato-no-disponible">No disponible</span>
                                    )}
                                </div>
                            </div>
                            <div className="dato-item">
                                <div className="dato-label">Cota</div>
                                <div className="dato-value">
                                    {datos.cota !== null && datos.cota !== undefined ? (
                                        <>{datos.cota.toFixed(2)}<span className="dato-unit">m.s.n.m</span></>
                                    ) : (
                                        <span className="dato-no-disponible">--</span>
                                    )}
                                </div>
                            </div>
                        </div>
                        
                        <div className="datos-grid" style={{marginTop: '10px'}}>
                            <div className="dato-item">
                                <div className="dato-label">Estacion</div>
                                <div className="dato-value">{datos.estacion}</div>
                            </div>
                            <div className="dato-item">
                                <div className="dato-label">Ubicacion</div>
                                <div className="dato-value" style={{fontSize: '1.3em'}}>Ecija</div>
                            </div>
                        </div>

                        <div className="datos-extra">
                            <div className="dato-extra">
                                <div className="dato-extra-label">Tendencia</div>
                                <div className="dato-extra-value">{tendencia}</div>
                            </div>
                            <div className="dato-extra">
                                <div className="dato-extra-label">Variacion</div>
                                <div className="dato-extra-value">
                                    {variacion ? `${variacion} m` : '--'}
                                </div>
                            </div>
                            <div className="dato-extra">
                                <div className="dato-extra-label">Proxy</div>
                                <div className="dato-extra-value">#{datos.proxyUsado}</div>
                            </div>
                        </div>

                        <div className="thresholds">
                            <div className="threshold-title">Umbrales de Alerta</div>
                            <div className="threshold-item threshold-verde">
                                <span style={{fontWeight: '600'}}>üü¢ Normal</span>
                                <strong>&lt; {UMBRALES.amarillo} m</strong>
                            </div>
                            <div className="threshold-item threshold-amarillo">
                                <span style={{fontWeight: '600'}}>üü° Precaucion</span>
                                <strong>{UMBRALES.amarillo} - {UMBRALES.naranja} m</strong>
                            </div>
                            <div className="threshold-item threshold-naranja">
                                <span style={{fontWeight: '600'}}>üü† Alerta</span>
                                <strong>{UMBRALES.naranja} - {UMBRALES.rojo} m</strong>
                            </div>
                            <div className="threshold-item threshold-rojo">
                                <span style={{fontWeight: '600'}}>üî¥ Emergencia</span>
                                <strong>{UMBRALES.rojo} - {UMBRALES.critico} m</strong>
                            </div>
                            <div className="threshold-item threshold-critico">
                                <span style={{fontWeight: '600'}}>‚ö´ Nivel Critico</span>
                                <strong>&gt; {UMBRALES.critico} m</strong>
                            </div>
                        </div>
                    </div>

                    {historico.length > 0 && (
                        <div className="chart-container">
                            <div className="chart-title">Evolucion Temporal</div>
                            <div style={{height: '280px'}}>
                                <canvas ref={chartRef}></canvas>
                            </div>
                            {historico.length === 1 && (
                                <div style={{textAlign: 'center', color: '#64748b', fontSize: '0.9em', marginTop: '10px'}}>
                                    Esperando mas datos para mostrar evolucion...
                                </div>
                            )}
                        </div>
                    )}

                    <div className="update-info">
                        <div style={{fontWeight: '600', fontSize: '1em', color: '#1e293b'}}>
                            Actualizado: {new Date(datos.timestamp).toLocaleString('es-ES')}
                        </div>
                        <div style={{marginTop: '8px', fontSize: '0.85em', color: '#64748b'}}>
                            Actualizacion automatica cada 3 minutos
                        </div>
                        <button 
                            className="refresh-btn" 
                            onClick={cargarDatos}
                            disabled={refreshing}
                        >
                            {refreshing ? '‚è≥ Actualizando...' : 'üîÑ Actualizar Datos'}
                        </button>
                    </div>

                    <div className="footer">
                        <div style={{fontWeight: '600'}}>
                            Fuente: SAIH - Confederacion Hidrografica del Guadalquivir
                        </div>
                        <div style={{fontSize: '0.85em', marginTop: '5px'}}>
                            www.chguadalquivir.es/saih
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MonitorGenil />, document.getElementById('root'));
    </script>
</body>
</html>
